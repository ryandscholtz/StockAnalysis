<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Watchlist Display Issue</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success {
            color: #10b981;
            font-weight: bold;
        }
        .error {
            color: #ef4444;
            font-weight: bold;
        }
        .info {
            color: #2563eb;
            font-weight: bold;
        }
        .warning {
            color: #f59e0b;
            font-weight: bold;
        }
        .code {
            background: #f3f4f6;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        .debug-box {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 6px;
            padding: 16px;
            margin: 16px 0;
        }
        .debug-steps {
            background: #eff6ff;
            border: 1px solid #2563eb;
            border-radius: 6px;
            padding: 16px;
            margin: 16px 0;
        }
    </style>
</head>
<body>
    <h1>üêõ Debug: AMZN Not Displaying in Watchlist</h1>
    
    <div class="test-section">
        <h2>üîç Issue Analysis</h2>
        <p class="warning">AMZN was successfully added to the watchlist (API returned success), but it's not showing up in the UI.</p>
        
        <h3>Possible Causes:</h3>
        <ol>
            <li><strong>API Not Persisting:</strong> API says success but doesn't actually save</li>
            <li><strong>Deduplication Issue:</strong> Item exists in both API and localStorage, wrong one kept</li>
            <li><strong>Timing Issue:</strong> Watchlist loads before API has time to save</li>
            <li><strong>Data Format Mismatch:</strong> API returns data in unexpected format</li>
        </ol>
    </div>
    
    <div class="debug-steps">
        <h3>üß™ Debug Steps to Run</h3>
        <p>Open browser dev tools and run these commands in the console:</p>
        
        <h4>1. Check localStorage:</h4>
        <div class="code">// Check what's in client-side storage
JSON.parse(localStorage.getItem('stock-analysis-watchlist') || '[]')</div>
        
        <h4>2. Check API response manually:</h4>
        <div class="code">// Make direct API call to see what server returns
fetch('https://dx0w31lbc1.execute-api.eu-west-1.amazonaws.com/production/api/watchlist', {
  headers: { 'Authorization': 'Bearer mock-jwt-token' }
}).then(r => r.json()).then(console.log)</div>
        
        <h4>3. Check deduplication logic:</h4>
        <div class="code">// See what the merge logic produces
// (This will be visible in console logs when you refresh /watchlist)</div>
    </div>
    
    <div class="test-section">
        <h2>üîß Quick Fixes to Try</h2>
        
        <h3>Option 1: Force Refresh Watchlist</h3>
        <p>Go to <code>/watchlist</code> and hard refresh (Ctrl+F5) to see if it's a caching issue.</p>
        
        <h3>Option 2: Check Browser Storage</h3>
        <p>Open Dev Tools ‚Üí Application ‚Üí Local Storage ‚Üí check if AMZN is there.</p>
        
        <h3>Option 3: Clear and Re-add</h3>
        <p>Clear localStorage and try adding AMZN again to see if it's a duplicate issue.</p>
        
        <div class="code">// Clear localStorage
localStorage.removeItem('stock-analysis-watchlist')
// Then try adding AMZN again</div>
    </div>
    
    <div class="debug-box">
        <h3>üîç What to Look For</h3>
        <p>Based on your console logs, the API call was successful:</p>
        <div class="code">API POST response: {success: true, message: 'Successfully added AMZN to watchlist', ticker: 'AMZN'}</div>
        
        <p>But the watchlist still shows 5 items instead of 6. This suggests:</p>
        <ul>
            <li>Either the API isn't actually persisting the data</li>
            <li>Or there's a deduplication issue removing the new item</li>
            <li>Or the item exists but isn't being displayed properly</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h2>üöÄ Immediate Action</h2>
        <p class="info">Please run the debug commands above and let me know what you see. This will help identify exactly where the issue is.</p>
        
        <p>Specifically, I need to know:</p>
        <ol>
            <li>What's in localStorage?</li>
            <li>What does the API actually return?</li>
            <li>Are there any console errors when loading the watchlist?</li>
        </ol>
    </div>
</body>
</html>